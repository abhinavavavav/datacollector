<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>User Info Collector</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; max-width: 700px; }
    label, input, textarea { display: block; margin: 10px 0; width: 100%; }
  </style>
</head>
<body>
  <h2>User Info Collection (with Consent)</h2>

  <form id="userForm" action="https://formsubmit.co/abhinavavpavithranav@email.com" method="POST">
    <label>Name: <input type="text" name="name" required></label>
    <label>Email: <input type="email" name="email" required></label>
    <label>Message: <textarea name="message" required></textarea></label>

    <label>
      <input type="checkbox" id="consentCheckbox" required>
      I give consent to collect my device and browser information.
    </label>

    <input type="hidden" name="collectedInfo" id="collectedInfo">

    <!-- FormSubmit options -->
    <input type="hidden" name="_template" value="table">
    <input type="hidden" name="_captcha" value="false">
    <input type="hidden" name="_subject" value="New User Info Collected">
    <input type="hidden" name="_next" value="https://thankyou.com"> <!-- Optional thank-you page -->

    <button type="submit">Submit</button>
  </form>

  <script>
    const form = document.getElementById('userForm');

    form.addEventListener('submit', async function (e) {
      e.preventDefault();

      if (!document.getElementById('consentCheckbox').checked) {
        alert('Please give consent to proceed.');
        return;
      }

      const formData = new FormData(form);
      const name = formData.get('name');
      const email = formData.get('email');
      const message = formData.get('message');

      const collected = {
        "Name": name,
        "Email": email,
        "Message": message,
        "User Agent": navigator.userAgent,
        "Language": navigator.language,
        "Platform": navigator.platform,
        "Vendor": navigator.vendor,
        "Screen Width": screen.width,
        "Screen Height": screen.height,
        "Pixel Ratio": window.devicePixelRatio,
        "Touch Support": 'ontouchstart' in window || navigator.maxTouchPoints > 0,
        "Timezone": Intl.DateTimeFormat().resolvedOptions().timeZone,
        "Local Time": new Date().toString(),
        "Device Memory (GB)": navigator.deviceMemory || "Not available",
        "CPU Threads": navigator.hardwareConcurrency || "Not available"
      };

      // Add connection info
      if ('connection' in navigator) {
        const conn = navigator.connection;
        collected["Connection Type"] = conn.type || "Unknown";
        collected["Effective Connection Type"] = conn.effectiveType || "Unknown";
        collected["Downlink (Mbps)"] = conn.downlink || "Unknown";
      }

      // Add battery info
      if ('getBattery' in navigator) {
        try {
          const battery = await navigator.getBattery();
          collected["Battery Level"] = (battery.level * 100) + "%";
          collected["Is Charging"] = battery.charging ? "Yes" : "No";
          collected["Charging Time (s)"] = battery.chargingTime;
          collected["Discharging Time (s)"] = battery.dischargingTime;
        } catch (err) {
          collected["Battery Info"] = "Permission denied or not supported";
        }
      } else {
        collected["Battery Info"] = "Not supported";
      }

      // Get location
      if ("geolocation" in navigator) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            collected["Location"] = {
              "Latitude": position.coords.latitude,
              "Longitude": position.coords.longitude,
              "Accuracy (m)": position.coords.accuracy
            };
            fetchIPAndSubmit(collected);
          },
          () => {
            collected["Location"] = "Denied or unavailable";
            fetchIPAndSubmit(collected);
          }
        );
      } else {
        collected["Location"] = "Geolocation not supported";
        fetchIPAndSubmit(collected);
      }
    });
    // Fetch public IP and submit form
    function fetchIPAndSubmit(collected) {
      fetch("https://api.ipify.org?format=json")
        .then((res) => res.json())
        .then((data) => {
          collected["Public IP"] = data.ip;
          document.getElementById('collectedInfo').value = JSON.stringify(collected, null, 2);
          form.submit();
        })
        .catch(() => {
          collected["Public IP"] = "Unavailable";
          document.getElementById('collectedInfo').value = JSON.stringify(collected, null, 2);
          form.submit();
        });
    }
  </script>
</body>
</html>
